!function(t){function i(t,i){image_wrapper_width=i}function e(t,i,e){var s,a=parseInt(t.css("top"),10);return"left"==i?(s="-"+this.image_wrapper_height+"px",t.css("top",this.image_wrapper_height+"px")):(s=this.image_wrapper_height+"px",t.css("top","-"+this.image_wrapper_height+"px")),e&&(e.css("bottom","-"+e[0].offsetHeight+"px"),e.animate({bottom:0},2*this.settings.animation_speed)),this.current_description&&this.current_description.animate({bottom:"-"+this.current_description[0].offsetHeight+"px"},2*this.settings.animation_speed),{old_image:{top:s},new_image:{top:a}}}function s(t,i,e){var s,a=parseInt(t.css("left"),10);return"left"==i?(s="-"+this.image_wrapper_width+"px",t.css("left",this.image_wrapper_width+"px")):(s=this.image_wrapper_width+"px",t.css("left","-"+this.image_wrapper_width+"px")),e&&(e.css("bottom","-"+e[0].offsetHeight+"px"),e.animate({bottom:0},2*this.settings.animation_speed)),this.current_description&&this.current_description.animate({bottom:"-"+this.current_description[0].offsetHeight+"px"},2*this.settings.animation_speed),{old_image:{left:s},new_image:{left:a}}}function a(t,i,e){var s=t.width(),a=t.height(),n=parseInt(t.css("left"),10),h=parseInt(t.css("top"),10);return t.css({width:0,height:0,top:this.image_wrapper_height/2,left:this.image_wrapper_width/2}),{old_image:{width:0,height:0,top:this.image_wrapper_height/2,left:this.image_wrapper_width/2},new_image:{width:s,height:a,top:h,left:n}}}function n(t,i,e){return t.css("opacity",0),{old_image:{opacity:0},new_image:{opacity:1}}}function h(t,i,e){return t.css("opacity",0),{old_image:{opacity:0},new_image:{opacity:1},speed:0}}function r(t,i){this.init(t,i)}function o(i,e){this.init(i,e),this.galOnPageCnt=t(".ad-gallery").length}t(window).resize(function(){t(".ad-gallery")[0]&&t(".ad-gallery")[0].width&&i("gallery",t(".ad-gallery")[0].width())}),t.fn.adGallery=function(i){var e={loader_image:"./ckeditor/plugins/slideshow/3rdParty/ad-gallery/loader.gif",start_at_index:0,update_window_hash:!0,description_wrapper:!1,thumb_opacity:.7,animate_first_image:!1,animation_speed:400,width:!1,height:!1,display_next_and_prev:!0,display_back_and_forward:!0,scroll_jump:0,slideshow:{enable:!0,autostart:!1,speed:5e3,start_label:"Start",stop_label:"Stop",stop_on_scroll:!0,countdown_prefix:"(",countdown_sufix:")",onStart:!1,onStop:!1},effect:"slide-hori",enable_keyboard_move:!0,cycle:!0,hooks:{displayDescription:!1},callbacks:{init:!1,afterImageVisible:!1,beforeImageVisible:!1},galRunCnt:0},s=t.extend(!1,e,i);i&&i.slideshow&&(s.slideshow=t.extend(!1,e.slideshow,i.slideshow)),s.slideshow.enable||(s.slideshow.autostart=!1);var a=[];return t(this).each(function(){var t=new r(this,s);a[a.length]=t}),a},r.prototype={wrapper:!1,image_wrapper:!1,gallery_info:!1,nav:!1,loader:!1,preloads:!1,thumbs_wrapper:!1,thumbs_wrapper_width:0,scroll_back:!1,scroll_forward:!1,next_link:!1,prev_link:!1,slideshow:!1,image_wrapper_width:0,image_wrapper_height:0,current_index:-1,current_image:!1,current_description:!1,nav_display_width:0,settings:!1,images:!1,in_transition:!1,animations:!1,galOnPageCnt:0,init:function(i,e){var s=this;this.wrapper=t(i),this.settings=e,this.setupElements(),this.setupAnimations(),this.settings.width?(this.image_wrapper_width=this.settings.width,this.image_wrapper.width(this.settings.width),this.wrapper.width(this.settings.width)):this.image_wrapper_width=this.image_wrapper.width(),this.settings.height?(this.image_wrapper_height=this.settings.height,this.image_wrapper.height(this.settings.height)):this.image_wrapper_height=this.image_wrapper.height(),this.nav_display_width=this.nav.width(),this.current_index=-1,this.current_image=!1,this.current_description=!1,this.in_transition=!1,this.findImages(),this.settings.display_next_and_prev&&this.initNextAndPrev();var a=function(t){return s.nextImage(t)};this.slideshow=new o(a,this.settings.slideshow),this.controls.append(this.slideshow.create()),this.settings.slideshow.enable?this.slideshow.enable():this.slideshow.disable(),this.settings.display_back_and_forward&&this.initBackAndForward(),this.settings.enable_keyboard_move&&this.initKeyEvents(),this.initHashChange();var n=parseInt(this.settings.start_at_index,10);"undefined"!=typeof this.getIndexFromHash()&&(n=this.getIndexFromHash()),this.loading(!0),this.showImage(n,function(){s.settings.slideshow.autostart&&(s.preloadImage(n+1),s.slideshow.start())}),this.fireCallback(this.settings.callbacks.init),t(window).resize(function(){this.image_wrapper_width=t(".ad-gallery").first().width()})},setupAnimations:function(){this.animations={"slide-vert":e,"slide-hori":s,resize:a,fade:n,none:h}},adjustSize:function(){this.wrapper[0].clientWidth>t(".ad-gallery").first().width()?this.image_wrapper_width=t(".ad-gallery").first().width():this.image_wrapper_width=this.wrapper[0].clientWidth},setupElements:function(){this.controls=this.wrapper.find(".ad-controls"),this.gallery_info=t('<p class="ad-info"></p>'),this.controls.append(this.gallery_info),this.image_wrapper=this.wrapper.find(".ad-image-wrapper"),this.image_wrapper.empty(),this.nav=this.wrapper.find(".ad-nav"),this.thumbs_wrapper=this.nav.find(".ad-thumbs"),this.preloads=t('<div class="ad-preloads"></div>'),this.loader=t('<img class="ad-loader" src="'+this.settings.loader_image+'">'),this.image_wrapper.append(this.loader),this.loader.hide(),t(document.body).append(this.preloads)},loading:function(t){t?this.loader.show():this.loader.hide()},addAnimation:function(i,e){t.isFunction(e)&&(this.animations[i]=e)},findImages:function(){var i=this;this.images=[];var e=0,s=this.thumbs_wrapper.find("a"),a=s.length;this.settings.thumb_opacity<1&&s.find("img").css("opacity",this.settings.thumb_opacity),s.each(function(s){var a=t(this);a.data("ad-i",s);var n=a.attr("href"),h=a.find("img");i.whenImageLoaded(h[0],function(){var t=h[0].parentNode.parentNode.offsetWidth;0==h[0].width&&(t=50),i.thumbs_wrapper_width+=t,e++}),i._initLink(a),i.images[s]=i._createImageData(a,n)});var n=setInterval(function(){a==e&&(i._setThumbListWidth(i.thumbs_wrapper_width),clearInterval(n))},300)},_setThumbListWidth:function(t){t+=25;var i=this.nav.find(".ad-thumb-list");i.css("width",t+"px")},_initLink:function(i){var e=this;i.click(function(){return e.showImage(i.data("ad-i")),e.slideshow.stop(),!1}).hover(function(){!t(this).is(".ad-active")&&e.settings.thumb_opacity<1&&t(this).find("img").fadeTo(300,1),e.preloadImage(i.data("ad-i"))},function(){!t(this).is(".ad-active")&&e.settings.thumb_opacity<1&&t(this).find("img").fadeTo(300,e.settings.thumb_opacity)})},_createImageData:function(t,i){var e=!1,s=t.find("img");s.data("ad-link")?e=t.data("ad-link"):s.attr("longdesc")&&s.attr("longdesc").length&&(e=s.attr("longdesc"));var a=!1;s.data("ad-desc")?a=s.data("ad-desc"):s.attr("alt")&&s.attr("alt").length&&(a=s.attr("alt"));var n=!1;return s.data("ad-title")?n=s.data("ad-title"):s.attr("title")&&s.attr("title").length&&(n=s.attr("title")),{thumb_link:t,image:i,error:!1,preloaded:!1,desc:a,title:n,size:!1,link:e}},initKeyEvents:function(){var i=this;t(document).keydown(function(t){39==t.keyCode?(i.nextImage(),i.slideshow.stop()):37==t.keyCode&&(i.prevImage(),i.slideshow.stop())})},getIndexFromHash:function(){if(window.location.hash&&0===window.location.hash.indexOf("#ad-image-")){var t=window.location.hash.replace(/^#ad-image-/g,""),i=this.thumbs_wrapper.find("#"+t);if(i.length)return this.thumbs_wrapper.find("a").index(i);if(!isNaN(parseInt(t,10)))return parseInt(t,10)}},removeImage:function(i){if(0>i||i>=this.images.length)throw"Cannot remove image for index "+i;var e=this.images[i];this.images.splice(i,1);var s=e.thumb_link,a=s[0].parentNode.offsetWidth;this.thumbs_wrapper_width-=a,s.remove(),this._setThumbListWidth(this.thumbs_wrapper_width),this.gallery_info.html(this.current_index+1+" / "+this.images.length),this.thumbs_wrapper.find("a").each(function(i){t(this).data("ad-i",i)}),i==this.current_index&&0!=this.images.length&&this.showImage(0)},removeAllImages:function(){for(var t=this.images.length-1;t>=0;t--)this.removeImage(t)},addImage:function(i,e,s,a,n){s=s||"",a=a||"",n=n||"";var h=t('<li><a href="'+e+'" id="'+s+'"><img src="'+i+'" title="'+a+'" alt="'+n+'"></a></li>'),r=this;this.thumbs_wrapper.find("ul").append(h);var o=h.find("a"),d=o.find("img");d.css("opacity",this.settings.thumb_opacity),this.whenImageLoaded(d[0],function(){var t=d[0].parentNode.parentNode.offsetWidth;0==d[0].width&&(t=100),r.thumbs_wrapper_width+=t,r._setThumbListWidth(r.thumbs_wrapper_width)});var l=this.images.length;o.data("ad-i",l),this._initLink(o),this.images[l]=r._createImageData(o,e),this.gallery_info.html(this.current_index+1+" / "+this.images.length)},initHashChange:function(){var i=this;if("onhashchange"in window)t(window).bind("hashchange",function(){var t=i.getIndexFromHash();"undefined"!=typeof t&&t!=i.current_index&&i.showImage(t)});else{var e=window.location.hash;setInterval(function(){if(window.location.hash!=e){e=window.location.hash;var t=i.getIndexFromHash();"undefined"!=typeof t&&t!=i.current_index&&i.showImage(t)}},200)}},initNextAndPrev:function(){this.next_link=t('<div class="ad-next"><div class="ad-next-image"></div></div>'),this.prev_link=t('<div class="ad-prev"><div class="ad-prev-image"></div></div>'),this.image_wrapper.append(this.next_link),this.image_wrapper.append(this.prev_link);var i=this;this.prev_link.add(this.next_link).mouseover(function(e){t(this).css("height",i.image_wrapper_height),t(this).find("div").show()}).mouseout(function(i){t(this).find("div").hide()}).click(function(){t(this).is(".ad-next")?(i.nextImage(),i.slideshow.stop()):(i.prevImage(),i.slideshow.stop())}).find("div").css("opacity",.7)},initBackAndForward:function(){var i=this;this.scroll_forward=t('<div class="ad-forward"></div>'),this.scroll_back=t('<div class="ad-back"></div>'),this.nav.append(this.scroll_forward),this.nav.prepend(this.scroll_back);var e=0,s=!1;t(this.scroll_back).add(this.scroll_forward).click(function(){var e,s=i.nav_display_width-50;return i.settings.scroll_jump>0&&(s=i.settings.scroll_jump),e=t(this).is(".ad-forward")?i.thumbs_wrapper.scrollLeft()+s:i.thumbs_wrapper.scrollLeft()-s,i.settings.slideshow.stop_on_scroll&&i.slideshow.stop(),i.thumbs_wrapper.animate({scrollLeft:e+"px"}),!1}).css("opacity",.6).hover(function(){var a="left";t(this).is(".ad-forward")&&(a="right"),s=setInterval(function(){e++,e>30&&i.settings.slideshow.stop_on_scroll&&i.slideshow.stop();var t=i.thumbs_wrapper.scrollLeft()+1;"left"==a&&(t=i.thumbs_wrapper.scrollLeft()-1),i.thumbs_wrapper.scrollLeft(t)},10),t(this).css("opacity",1)},function(){e=0,clearInterval(s),t(this).css("opacity",.6)})},_afterShow:function(){if(this.gallery_info.html(this.current_index+1+" / "+this.images.length),this.settings.cycle||(this.prev_link.show().css("height",this.image_wrapper_height),this.next_link.show().css("height",this.image_wrapper_height),this.current_index==this.images.length-1&&this.next_link.hide(),0==this.current_index&&this.prev_link.hide()),this.settings.update_window_hash){var t=this.images[this.current_index].thumb_link;t.attr("id")?window.location.hash="#ad-image-"+t.attr("id"):window.location.hash="#ad-image-"+this.current_index}this.fireCallback(this.settings.callbacks.afterImageVisible)},_getContainedImageSize:function(t,i){if(this.adjustSize(),i>this.image_wrapper_height){var e=t/i;i=this.image_wrapper_height,t=this.image_wrapper_height*e}if(t>this.image_wrapper_width){var e=i/t;t=this.image_wrapper_width,i=this.image_wrapper_width*e}return{width:t,height:i}},_centerImage:function(t,i,e){if(t.css("top","0px"),e<this.image_wrapper_height){var s=this.image_wrapper_height-e;t.css("top",s/2+"px")}t.css("width","100%"),t.css("text-align","center")},_getDescription:function(i){var e="",s='<p class="ad-image-description">';if(i.desc.length||i.title.length){var a="";if(i.title.length?a='<strong class="ad-description-title">'+i.title+"</strong>":s="",e="",i.desc.length)if(i.desc.indexOf("IMAGE_LINK_")>=0){e='<span style="display:none;">'+i.desc+"</span>";var n=window.location.href.trim(),h=i.desc.substring(12).trim();n==h&&(s="",a="")}else e="<span>"+i.desc+"</span>";e=t(s+a+e+"</p>")}return e},showImage:function(t,i){if(this.images[t]&&!this.in_transition&&t!=this.current_index){var e=this,s=this.images[t];this.in_transition=!0,s.preloaded?this._showWhenLoaded(t,i):(this.loading(!0),this.preloadImage(t,function(){e.loading(!1),e._showWhenLoaded(t,i)}))}},_showWhenLoaded:function(i,e){if(this.images[i]){var s=this,a=this.images[i],n=t(document.createElement("div")).addClass("ad-image"),h=t(new Image).attr("src",a.image);if(a.link){var r=t('<a href="'+a.link+'" target="_blank"></a>');r.append(h),n.append(r)}else n.append(h);this.image_wrapper.prepend(n);var o=this._getContainedImageSize(a.size.width,a.size.height);h.attr("width",o.width),h.attr("height",o.height),n.css({width:o.width+"px",height:o.height+"px"}),this._centerImage(n,o.width,o.height);var d=this._getDescription(a);if(d)if(this.settings.description_wrapper||this.settings.hooks.displayDescription)if(this.settings.hooks.displayDescription)this.settings.hooks.displayDescription.call(this,a);else{var l=this.settings.description_wrapper;l.append(d)}else{n.append(d);o.width-parseInt(d.css("padding-left"),10)-parseInt(d.css("padding-right"),10)}this.highLightThumb(this.images[i].thumb_link);var p="right";if(this.current_index<i&&(p="left"),this.fireCallback(this.settings.callbacks.beforeImageVisible),this.current_image||this.settings.animate_first_image){var c=this.settings.animation_speed,g="swing",_=this.animations[this.settings.effect].call(this,n,p,d);if("undefined"!=typeof _.speed&&(c=_.speed),"undefined"!=typeof _.easing&&(g=_.easing),this.current_image){var m=this.current_image,w=this.current_description;m.animate(_.old_image,c,g,function(){m.remove(),w&&w.remove()})}n.animate(_.new_image,c,g,function(){s.current_index=i,s.current_image=n,s.current_description=d,s.in_transition=!1,s._afterShow(),s.fireCallback(e)})}else this.current_index=i,this.current_image=n,s.current_description=d,this.in_transition=!1,s._afterShow(),this.fireCallback(e)}},nextIndex:function(){var t;if(this.current_index==this.images.length-1){if(!this.settings.cycle)return!1;t=0}else t=this.current_index+1;return t},nextImage:function(t){var i=this.nextIndex();return i===!1?!1:(this.preloadImage(i+1),this.showImage(i,t),!0)},prevIndex:function(){var t;if(0==this.current_index){if(!this.settings.cycle)return!1;t=this.images.length-1}else t=this.current_index-1;return t},prevImage:function(t){var i=this.prevIndex();return i===!1?!1:(this.preloadImage(i-1),this.showImage(i,t),!0)},preloadAll:function(){function t(){e<i.images.length&&(e++,i.preloadImage(e,t))}var i=this,e=0;i.preloadImage(e,t)},preloadImage:function(i,e){if(this.images[i]){var s=this.images[i];if(this.images[i].preloaded)this.fireCallback(e);else{var a=t(new Image);if(a.attr("src",s.image),this.isImageLoaded(a[0]))s.preloaded=!0,s.size={width:a[0].width,height:a[0].height},this.fireCallback(e);else{this.preloads.append(a);var n=this;a.load(function(){s.preloaded=!0,s.size={width:this.width,height:this.height},n.fireCallback(e)}).error(function(){s.error=!0,s.preloaded=!1,s.size=!1})}}}},whenImageLoaded:function(i,e){this.isImageLoaded(i)?e&&e():t(i).load(e)},isImageLoaded:function(t){return"undefined"==typeof t.complete||t.complete?"undefined"!=typeof t.naturalWidth&&0==t.naturalWidth?!1:!0:!1},highLightThumb:function(t){this.thumbs_wrapper.find(".ad-active").removeClass("ad-active"),t.addClass("ad-active"),this.settings.thumb_opacity<1&&(this.thumbs_wrapper.find("a:not(.ad-active) img").fadeTo(300,this.settings.thumb_opacity),t.find("img").fadeTo(300,1));var i=t[0].parentNode.offsetLeft;i-=this.nav_display_width/2-t[0].offsetWidth/2,this.thumbs_wrapper.animate({scrollLeft:i+"px"})},fireCallback:function(i){t.isFunction(i)&&i.call(this)}},o.prototype={start_link:!1,stop_link:!1,countdown:!1,controls:!1,settings:!1,nextimage_callback:!1,enabled:!1,running:!1,countdown_interval:!1,init:function(t,i){this.nextimage_callback=t,this.settings=i},create:function(){this.start_link=t('<span class="ad-slideshow-start">'+this.settings.start_label+"</span>"),this.stop_link=t('<span class="ad-slideshow-stop">'+this.settings.stop_label+"</span>"),this.countdown=t('<span class="ad-slideshow-countdown"></span>'),this.controls=t('<div class="ad-slideshow-controls"></div>'),this.controls.append(this.start_link).append(this.stop_link).append(this.countdown),this.countdown.hide();var i=this;return this.start_link.click(function(){i.start()}),this.stop_link.click(function(){i.stop()}),t(document).keydown(function(t){83==t.keyCode&&(i.running?i.stop():i.start())}),this.controls},disable:function(){this.enabled=!1,this.stop(),this.controls.hide()},enable:function(){this.enabled=!0,this.controls.show()},toggle:function(){this.enabled?this.disable():this.enable()},start:function(){return this.settings.galRunCnt=0,this.running||!this.enabled?!1:(this.running=!0,this.controls.addClass("ad-slideshow-running"),this._next(),this.fireCallback(this.settings.onStart),!0)},stop:function(){return this.running?(this.running=!1,this.countdown.hide(),this.controls.removeClass("ad-slideshow-running"),clearInterval(this.countdown_interval),this.fireCallback(this.settings.onStop),!0):!1},_next:function(){this.settings.galRunCnt++;var t=1e3;this.settings.galRunCnt<=this.galOnPageCnt;var i=this,e=this.settings.countdown_prefix,s=this.settings.countdown_sufix;clearInterval(i.countdown_interval),this.countdown.show().html(e+this.settings.speed/1e3+s);var a=0;this.countdown_interval=setInterval(function(){if(a+=1e3,a>=i.settings.speed){var t=function(){i.running&&i._next(),a=0};i.nextimage_callback(t)||i.stop(),a=0}var n=parseInt(i.countdown.text().replace(/[^0-9]/g,""),10);n--,n>0&&i.countdown.html(e+n+s)},t)},fireCallback:function(i){t.isFunction(i)&&i.call(this)}}}(jQuery);